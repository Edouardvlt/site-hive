import React, { useState, useEffect } from 'react';
import {
Users,
CheckSquare,
MapPin,
AlertTriangle,
Music,
Tent,
BatteryCharging,
CreditCard,
Truck,
Clock,
ShieldAlert,
ChevronDown,
ChevronUp
} from 'lucide-react';

const HiveDashboard = () => {
const [activeTab, setActiveTab] = useState('squad');
const [glitch, setGlitch] = useState(false);

// --- DATA & STATE ---

// Liste des participants (Mock data based on 8 pax)
const [squad, setSquad] = useState([
{ id: 1, name: "Pilote 1", role: "Driver Principal", ticket: true, paid: true },
{ id: 2, name: "Pilote 2", role: "Co-Pilote", ticket: true, paid: true },
{ id: 3, name: "Membre 3", role: "Logistique", ticket: false, paid: false },
{ id: 4, name: "Membre 4", role: "Ravitaillement", ticket: false, paid: false },
{ id: 5, name: "Membre 5", role: "Sécurité Camp", ticket: true, paid: false },
{ id: 6, name: "Membre 6", role: "Technique", ticket: false, paid: false },
{ id: 7, name: "Membre 7", role: "Moral Support", ticket: true, paid: true },
{ id: 8, name: "Membre 8", role: "Médic", ticket: false, paid: false },
]);

// Checklists basées sur le rapport
const [personalGear, setPersonalGear] = useState([
{ id: 1, item: "Billet Festival (PDF + Wallet)", checked: false, critical: true },
{ id: 2, item: "Passeport / CNI Valide", checked: false, critical: true },
{ id: 3, item: "Sac de couchage (Nuits froides)", checked: false },
{ id: 4, item: "Matelas gonflable épais (Sol dur)", checked: false },
{ id: 5, item: "Batterie Externe (20 000 mAh min)", checked: false, critical: true },
{ id: 6, item: "Bouchons d'oreilles (Haute fidélité)", checked: false, critical: true },
{ id: 7, item: "Gourde (Vide à l'entrée)", checked: false },
{ id: 8, item: "Chaussures fermées/Rangers (Poussière)", checked: false },
{ id: 9, item: "Vêtements Chauds (Nuit) & Légers (Jour)", checked: false },
{ id: 10, item: "Kit Hygiène (Lingettes, Gel Hydro)", checked: false },
{ id: 11, item: "Argent Liquide (Secours)", checked: false },
{ id: 12, item: "Gilet Jaune (Trajet Allemagne)", checked: false },
]);

const [groupGear, setGroupGear] = useState([
{ id: 1, item: "Tonnelle 3x3m (Vital : Soleil)", checked: false, critical: true },
{ id: 2, item: "Enceinte Bluetooth (Pas de Sound System)", checked: false },
{ id: 3, item: "Chaises pliantes (8x)", checked: false },
{ id: 4, item: "Jerrycans d'eau (2x 10L)", checked: false },
{ id: 5, item: "Diable / Chariot (Si pas de Car Camping)", checked: false },
{ id: 6, item: "Gaffer Tape & Rilsans", checked: false },
{ id: 7, item: "Trousse Secours (Norme DIN 13164)", checked: false, critical: true },
{ id: 8, item: "Glacières Performantes", checked: false },
{ id: 9, item: "Lampes Torches / Frontales", checked: false },
]);

// --- ACTIONS ---

const toggleTicket = (id) => {
setSquad(squad.map(p => p.id === id ? { ...p, ticket: !p.ticket } : p));
};

const togglePersonalCheck = (id) => {
setPersonalGear(personalGear.map(i => i.id === id ? { ...i, checked: !i.checked } : i));
};

const toggleGroupCheck = (id) => {
setGroupGear(groupGear.map(i => i.id === id ? { ...i, checked: !i.checked } : i));
};

// Glitch effect loop
useEffect(() => {
const interval = setInterval(() => {
setGlitch(true);
setTimeout(() => setGlitch(false), 200);
}, 5000);
return () => clearInterval(interval);
}, []);

// --- COMPONENTS ---

const SectionTitle = ({ title, icon: Icon }) => (
<div className="flex items-center gap-3 mb-6 border-b border-yellow-500/30 pb-2">
    <Icon className="text-yellow-400 w-6 h-6" />
    <h2 className="text-2xl font-black tracking-widest text-white uppercase glitch-text" data-text={title}>
        {title}
    </h2>
</div>
);

const ProgressBar = ({ current, total }) => {
const percent = Math.round((current / total) * 100);
return (
<div className="w-full bg-zinc-900 h-4 border border-zinc-700 mt-2 relative overflow-hidden">
    <div className="h-full bg-yellow-500 transition-all duration-500" style={{ width: `${percent}%` }} />
    <span
        className="absolute inset-0 flex items-center justify-center text-[10px] font-mono text-white mix-blend-difference">
        {percent}% READY
    </span>
</div>
);
};

return (
<div
    className="min-h-screen bg-black text-zinc-300 font-mono selection:bg-yellow-500 selection:text-black overflow-x-hidden">

    {/* BACKGROUND NOISE & GRID */}
    <div className="fixed inset-0 pointer-events-none opacity-10 z-0" style={{
        backgroundImage: 'radial-gradient(circle, #333 1px, transparent 1px)' , backgroundSize: '20px 20px' }}>
    </div>

    {/* HEADER */}
    <header
        className="relative z-10 border-b-4 border-yellow-500 bg-zinc-950 p-6 md:p-10 flex flex-col md:flex-row justify-between items-center gap-6">
        <div className="text-center md:text-left">
            <h1 className={`text-5xl md:text-7xl font-black text-white tracking-tighter uppercase transform ${glitch
                ? 'translate-x-1' : '' }`}>
                HIVE <span className="text-yellow-500">2026</span>
            </h1>
            <p className="text-sm tracking-[0.3em] text-zinc-500 uppercase mt-2">
                Opération Pornic <span className="text-yellow-500">➔</span> Ferropolis
            </p>
        </div>

        <div className="flex flex-col items-center md:items-end gap-2">
            <div className="bg-zinc-900 border border-zinc-700 px-4 py-2 flex items-center gap-2">
                <Clock className="w-4 h-4 text-yellow-500 animate-pulse" />
                <span className="text-xl font-bold text-white">J-158</span>
                <span className="text-xs text-zinc-500">AVANT DÉPART</span>
            </div>
            <div className="text-xs text-zinc-500">
                DÉPART: 18 JUIN 2026 - 21:00
            </div>
        </div>
    </header>

    {/* NAVIGATION */}
    <nav className="sticky top-0 z-50 bg-black/90 backdrop-blur border-b border-zinc-800 overflow-x-auto">
        <div className="flex justify-center min-w-max p-2">
            {[
            { id: 'squad', label: "L'EQUIPE", icon: Users },
            { id: 'gear', label: 'LOGISTIQUE', icon: CheckSquare },
            { id: 'roadmap', label: 'PLAN DE VOL', icon: MapPin },
            { id: 'budget', label: 'FINANCE', icon: CreditCard },
            ].map((tab) => (
            <button key={tab.id} onClick={()=> setActiveTab(tab.id)}
                className={`
                flex items-center gap-2 px-6 py-3 text-sm font-bold uppercase tracking-wider transition-all border-r
                border-zinc-900 last:border-r-0
                ${activeTab === tab.id
                ? 'bg-yellow-500 text-black shadow-[0_0_20px_rgba(234,179,8,0.5)]'
                : 'text-zinc-500 hover:text-white hover:bg-zinc-900'}
                `}
                >
                <tab.icon className="w-4 h-4" />
                {tab.label}
            </button>
            ))}
        </div>
    </nav>

    <main className="relative z-10 max-w-6xl mx-auto p-4 md:p-8">

        {/* --- SQUAD TAB --- */}
        {activeTab === 'squad' && (
        <div className="animate-fadeIn">
            <SectionTitle title="Membres de l'Expédition" icon={Users} />

            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
                {squad.map((member) => (
                <div key={member.id}
                    className="group relative bg-zinc-900/50 border border-zinc-800 hover:border-yellow-500 transition-all p-5 overflow-hidden">
                    <div
                        className="absolute top-0 right-0 w-8 h-8 bg-zinc-800 -mr-4 -mt-4 transform rotate-45 group-hover:bg-yellow-500 transition-colors">
                    </div>

                    <div className="flex justify-between items-start mb-4">
                        <div>
                            <h3 className="text-lg font-bold text-white">{member.name}</h3>
                            <span className="text-xs text-zinc-500 uppercase">{member.role}</span>
                        </div>
                        <div className="h-2 w-2 rounded-full bg-green-500 shadow-[0_0_10px_#22c55e]"></div>
                    </div>

                    <div className="space-y-3">
                        <button onClick={()=> toggleTicket(member.id)}
                            className={`w-full flex items-center justify-between p-2 text-xs border ${member.ticket ?
                            'border-yellow-500/50 bg-yellow-500/10 text-yellow-500' : 'border-red-900/50 bg-red-900/10
                            text-red-500'} transition-all`}
                            >
                            <span>TICKET</span>
                            {member.ticket ?
                            <CheckSquare className="w-4 h-4" /> :
                            <div className="w-4 h-4 border border-current" />}
                        </button>

                        <div
                            className="flex justify-between text-xs text-zinc-500 font-mono pt-2 border-t border-zinc-800">
                            <span>BUDGET EST.</span>
                            <span>~635€</span>
                        </div>
                    </div>
                </div>
                ))}
            </div>

            <div className="bg-zinc-900 border-l-4 border-red-500 p-6">
                <h3 className="text-red-500 font-bold flex items-center gap-2 mb-2">
                    <AlertTriangle className="w-5 h-5" />
                    PROCÉDURE CRITIQUE
                </h3>
                <p className="text-sm text-zinc-400">
                    L'achat du <strong>Car Camping Pass</strong> (~39€) est impératif pour garer le minibus sur le
                    campement. Sans cela, distance parking-camping énorme à faire à pied.
                </p>
            </div>
        </div>
        )}

        {/* --- GEAR TAB --- */}
        {activeTab === 'gear' && (
        <div className="animate-fadeIn space-y-8">

            {/* PERSONAL */}
            <div>
                <div className="flex justify-between items-end mb-4">
                    <SectionTitle title="Équipement Individuel" icon={ShieldAlert} />
                    <div className="w-32">
                        <ProgressBar current={personalGear.filter(i=> i.checked).length} total={personalGear.length} />
                    </div>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                    {personalGear.map((item) => (
                    <div key={item.id} onClick={()=> togglePersonalCheck(item.id)}
                        className={`
                        cursor-pointer flex items-center p-3 border transition-all
                        ${item.checked
                        ? 'bg-zinc-900 border-zinc-700 opacity-50'
                        : 'bg-black border-zinc-600 hover:border-yellow-500'}
                        `}
                        >
                        <div className={`w-5 h-5 mr-3 flex items-center justify-center border ${item.checked
                            ? 'bg-yellow-500 border-yellow-500 text-black' : 'border-zinc-500' }`}>
                            {item.checked &&
                            <CheckSquare className="w-3 h-3" />}
                        </div>
                        <span className={item.checked ? 'line-through' : '' }>
                            {item.item}
                        </span>
                        {item.critical && (
                        <span
                            className="ml-auto text-[10px] bg-red-900/30 text-red-500 border border-red-900 px-1">VITAL</span>
                        )}
                    </div>
                    ))}
                </div>
            </div>

            {/* GROUP */}
            <div>
                <div className="flex justify-between items-end mb-4">
                    <SectionTitle title="Équipement Camp Base" icon={Tent} />
                    <div className="w-32">
                        <ProgressBar current={groupGear.filter(i=> i.checked).length} total={groupGear.length} />
                    </div>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                    {groupGear.map((item) => (
                    <div key={item.id} onClick={()=> toggleGroupCheck(item.id)}
                        className={`
                        cursor-pointer flex items-center p-3 border transition-all
                        ${item.checked
                        ? 'bg-zinc-900 border-zinc-700 opacity-50'
                        : 'bg-black border-zinc-600 hover:border-yellow-500'}
                        `}
                        >
                        <div className={`w-5 h-5 mr-3 flex items-center justify-center border ${item.checked
                            ? 'bg-yellow-500 border-yellow-500 text-black' : 'border-zinc-500' }`}>
                            {item.checked &&
                            <CheckSquare className="w-3 h-3" />}
                        </div>
                        <span className={item.checked ? 'line-through' : '' }>
                            {item.item}
                        </span>
                        {item.critical && (
                        <span
                            className="ml-auto text-[10px] bg-red-900/30 text-red-500 border border-red-900 px-1">VITAL</span>
                        )}
                    </div>
                    ))}
                </div>
            </div>

            {/* FORBIDDEN ITEMS */}
            <div className="mt-8 border border-red-900 bg-red-950/10 p-4">
                <h3 className="text-red-500 font-bold mb-3 uppercase tracking-widest">Objets Bannis (Zone Rouge)</h3>
                <ul className="grid grid-cols-2 md:grid-cols-4 gap-4 text-xs text-red-300/70">
                    <li className="flex items-center gap-2"><span className="text-red-500">×</span> LE VERRE (Strict !)
                    </li>
                    <li className="flex items-center gap-2"><span className="text-red-500">×</span> GÉNÉRATEURS ESSENCE
                    </li>
                    <li className="flex items-center gap-2"><span className="text-red-500">×</span> GROSSES BOUTEILLES
                        GAZ</li>
                    <li className="flex items-center gap-2"><span className="text-red-500">×</span> SOUND SYSTEMS (PA)
                    </li>
                </ul>
            </div>
        </div>
        )}

        {/* --- ROADMAP TAB --- */}
        {activeTab === 'roadmap' && (
        <div className="animate-fadeIn">
            <SectionTitle title="Plan de Vol & Itinéraire" icon={MapPin} />

            <div className="relative border-l-2 border-zinc-800 ml-4 space-y-12 my-10">

                {/* Step 1 */}
                <div className="relative pl-8">
                    <div
                        className="absolute -left-[9px] top-0 w-4 h-4 bg-yellow-500 rounded-full shadow-[0_0_15px_#eab308]">
                    </div>
                    <div className="bg-zinc-900/50 p-4 border border-zinc-800">
                        <h4 className="text-yellow-500 font-bold text-lg">J-1 / JEUDI 18 JUIN - 21:00</h4>
                        <p className="text-white font-bold">DÉPART PORNIC</p>
                        <p className="text-sm text-zinc-500 mt-2">Objectif : Traverser Paris de nuit (01h00-02h00) pour
                            éviter l'enfer.</p>
                    </div>
                </div>

                {/* Step 2 */}
                <div className="relative pl-8">
                    <div className="absolute -left-[9px] top-0 w-4 h-4 bg-zinc-700 rounded-full"></div>
                    <div className="bg-zinc-900/50 p-4 border border-zinc-800">
                        <h4 className="text-white font-bold">TRANSIT BELGIQUE / ALLEMAGNE</h4>
                        <p className="text-sm text-zinc-500 mt-2">
                            Trajet via Mons/Liège/Aix-la-Chapelle.
                            <br /><span className="text-red-400">Attention : Contrôles Police fréquents aux
                                frontières.</span>
                        </p>
                    </div>
                </div>

                {/* Step 3 */}
                <div className="relative pl-8">
                    <div className="absolute -left-[9px] top-0 w-4 h-4 bg-zinc-700 rounded-full"></div>
                    <div className="bg-zinc-900/50 p-4 border border-zinc-800">
                        <h4 className="text-white font-bold">VENDREDI 19 JUIN - 13:00</h4>
                        <p className="text-white">ARRIVÉE FERROPOLIS</p>
                        <ul className="text-sm text-zinc-500 mt-2 list-disc list-inside">
                            <li>Dernier ravitaillement frais (Lidl/Aldi local)</li>
                            <li>Check-in Camping & Installation Tonnelle</li>
                            <li>Vignette écologique obligatoire !</li>
                        </ul>
                    </div>
                </div>

                {/* Step 4 */}
                <div className="relative pl-8">
                    <div
                        className="absolute -left-[9px] top-0 w-4 h-4 bg-green-500 rounded-full shadow-[0_0_15px_#22c55e]">
                    </div>
                    <div className="bg-zinc-900/50 p-4 border border-zinc-800">
                        <h4 className="text-green-500 font-bold text-lg">VENDREDI 19 JUIN - 16:00</h4>
                        <p className="text-white font-bold">OUVERTURE DES HOSTILITÉS</p>
                        <p className="text-sm text-zinc-500 mt-2">Mode survie activé.</p>
                    </div>
                </div>

            </div>

            <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mt-8">
                <div className="bg-zinc-950 border border-zinc-800 p-4 text-center">
                    <Truck className="w-8 h-8 mx-auto text-yellow-500 mb-2" />
                    <div className="text-2xl font-bold text-white">2 900 KM</div>
                    <div className="text-xs text-zinc-500">DISTANCE TOTALE</div>
                </div>
                <div className="bg-zinc-950 border border-zinc-800 p-4 text-center">
                    <Clock className="w-8 h-8 mx-auto text-yellow-500 mb-2" />
                    <div className="text-2xl font-bold text-white">16H00</div>
                    <div className="text-xs text-zinc-500">TEMPS TRAJET ALLER</div>
                </div>
                <div className="bg-zinc-950 border border-zinc-800 p-4 text-center">
                    <BatteryCharging className="w-8 h-8 mx-auto text-yellow-500 mb-2" />
                    <div className="text-2xl font-bold text-white">255 L</div>
                    <div className="text-xs text-zinc-500">DIESEL ESTIMÉ</div>
                </div>
            </div>
        </div>
        )}

        {/* --- BUDGET TAB --- */}
        {activeTab === 'budget' && (
        <div className="animate-fadeIn">
            <SectionTitle title="Analyse Financière" icon={CreditCard} />

            <div className="overflow-x-auto">
                <table className="w-full text-left border-collapse">
                    <thead>
                        <tr className="border-b border-zinc-700 text-xs uppercase text-zinc-500">
                            <th className="p-3">Poste de Dépense</th>
                            <th className="p-3 text-right">Total Groupe (8)</th>
                            <th className="p-3 text-right text-yellow-500">Par Personne</th>
                        </tr>
                    </thead>
                    <tbody className="divide-y divide-zinc-800 font-mono text-sm">
                        <tr>
                            <td className="p-3">Billet Festival + Camping</td>
                            <td className="p-3 text-right">1 960 €</td>
                            <td className="p-3 text-right text-white">245 €</td>
                        </tr>
                        <tr>
                            <td className="p-3">Location Minibus (L2H1)</td>
                            <td className="p-3 text-right">850 €</td>
                            <td className="p-3 text-right text-white">106 €</td>
                        </tr>
                        <tr>
                            <td className="p-3">Carburant (Diesel)</td>
                            <td className="p-3 text-right">433 €</td>
                            <td className="p-3 text-right text-white">54 €</td>
                        </tr>
                        <tr>
                            <td className="p-3">Péages & Vignettes</td>
                            <td className="p-3 text-right">230 €</td>
                            <td className="p-3 text-right text-white">29 €</td>
                        </tr>
                        <tr>
                            <td className="p-3">Courses (Nourriture/Alcool)</td>
                            <td className="p-3 text-right">400 €</td>
                            <td className="p-3 text-right text-white">50 €</td>
                        </tr>
                        <tr>
                            <td className="p-3">Budget Sur Place (Cashless)</td>
                            <td className="p-3 text-right">1 200 €</td>
                            <td className="p-3 text-right text-white">150 €</td>
                        </tr>
                        <tr className="bg-yellow-500/10 border-t-2 border-yellow-500">
                            <td className="p-3 font-bold text-yellow-500">TOTAL ESTIMÉ</td>
                            <td className="p-3 text-right font-bold text-yellow-500">5 073 €</td>
                            <td className="p-3 text-right font-bold text-yellow-500 text-lg">~634 €</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div className="mt-8 p-4 bg-zinc-900/50 border border-zinc-700 text-xs text-zinc-400">
                <p>NOTE: Le budget carburant est calculé sur une moyenne de 1.70€/L. Prévoir une marge de sécurité de
                    10%. Les dépenses sur place (Cashless) dépendent de la consommation individuelle.</p>
            </div>
        </div>
        )}

    </main>

    {/* FOOTER */}
    <footer className="mt-20 border-t border-zinc-800 p-8 text-center text-xs text-zinc-600 font-mono">
        <p>HIVE FESTIVAL EXPEDITION // PORNIC CHAPTER</p>
        <p className="mt-2">SYSTEME: OPÉRATIONNEL</p>
    </footer>

    {/* CUSTOM CSS FOR ANIMATIONS */}
    <style>
        {
            ` .glitch-text {
                position: relative;
            }

            .glitch-text::before,
            .glitch-text::after {
                content: attr(data-text);
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
            }

            .glitch-text::before {
                left: 2px;
                text-shadow: -1px 0 red;
                clip: rect(44px, 450px, 56px, 0);
                animation: glitch-anim 5s infinite linear alternate-reverse;
            }

            .glitch-text::after {
                left: -2px;
                text-shadow: -1px 0 blue;
                clip: rect(44px, 450px, 56px, 0);
                animation: glitch-anim2 5s infinite linear alternate-reverse;
            }

            @keyframes glitch-anim {
                0% {
                    clip: rect(10px, 9999px, 30px, 0);
                }

                20% {
                    clip: rect(80px, 9999px, 100px, 0);
                }

                40% {
                    clip: rect(40px, 9999px, 60px, 0);
                }

                60% {
                    clip: rect(20px, 9999px, 50px, 0);
                }

                80% {
                    clip: rect(90px, 9999px, 100px, 0);
                }

                100% {
                    clip: rect(60px, 9999px, 80px, 0);
                }
            }

            @keyframes glitch-anim2 {
                0% {
                    clip: rect(60px, 9999px, 80px, 0);
                }

                20% {
                    clip: rect(10px, 9999px, 30px, 0);
                }

                40% {
                    clip: rect(90px, 9999px, 100px, 0);
                }

                60% {
                    clip: rect(20px, 9999px, 50px, 0);
                }

                80% {
                    clip: rect(40px, 9999px, 60px, 0);
                }

                100% {
                    clip: rect(80px, 9999px, 100px, 0);
                }
            }

            @keyframes fadeIn {
                from {
                    opacity: 0;
                    transform: translateY(10px);
                }

                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .animate-fadeIn {
                animation: fadeIn 0.5s ease-out forwards;
            }

            `
        }
    </style>
</div>
);
};

export default HiveDashboard;